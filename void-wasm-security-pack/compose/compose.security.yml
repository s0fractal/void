services:
  wasm-exec:
    build:
      context: ..
      dockerfile: docker/exec.security.Dockerfile
    environment:
      - RELAY_BASE=http://relay:8787
      - SSE_PATH=/sse
      - EVENT_POST=/event
      - ALLOW_MODULES=wasm/ci/*,wasm/pulse/*,wasm/demo/*
      - ALLOW_CAPS=emit
      - COSIGN_VERIFY=1
      - OPA_BASE=http://opa-pdp:8181
      - OPA_DECISION=/v1/data/void/policy/allow
      - WASM_DRYRUN=0
    networks: [ voidnet ]
    restart: unless-stopped
    ports: ["9490:9490"]
networks:
  voidnet: { external: true }
